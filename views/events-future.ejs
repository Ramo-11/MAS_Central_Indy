<!-- Future Events Hero Section -->
<section class="events-hero">
    <div class="container">
        <div class="events-hero-content">
            <h1 class="events-hero-title">Upcoming Events</h1>
            <p class="events-hero-subtitle">Discover our upcoming events and activities. Save the dates and join us for meaningful experiences in our community.</p>
        </div>
    </div>
</section>

<!-- Error Banner (if error exists) -->
<% if (typeof error !== 'undefined' && error) { %>
<section class="error-banner">
    <div class="container">
        <div class="error-banner-content">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <p><%= error %></p>
        </div>
    </div>
</section>
<% } %>

<!-- Category Filter Navigation -->
<section class="category-filter-section">
    <div class="container">
        <div class="category-filter">
            <button class="category-filter-btn <%= currentCategory === 'all' ? 'active' : '' %>" data-category="all">All Events</button>
            <button class="category-filter-btn <%= currentCategory === 'community-service' ? 'active' : '' %>" data-category="community-service">Community Service</button>
            <button class="category-filter-btn <%= currentCategory === 'educational' ? 'active' : '' %>" data-category="educational">Educational</button>
            <button class="category-filter-btn <%= currentCategory === 'religious' ? 'active' : '' %>" data-category="religious">Religious</button>
            <button class="category-filter-btn <%= currentCategory === 'cultural' ? 'active' : '' %>" data-category="cultural">Cultural</button>
            <button class="category-filter-btn <%= currentCategory === 'youth' ? 'active' : '' %>" data-category="youth">Youth Program</button>
            <button class="category-filter-btn <%= currentCategory === 'interfaith' ? 'active' : '' %>" data-category="interfaith">Interfaith</button>
            <button class="category-filter-btn <%= currentCategory === 'social' ? 'active' : '' %>" data-category="social">Social Event</button>
        </div>
    </div>
</section>

<!-- Featured Events Section -->
<% if (featuredEvents && featuredEvents.length > 0) { %>
<section class="featured-events">
    <div class="container">
        <h2 class="section-title">Featured Upcoming Events</h2>
        <div class="featured-grid">
            <% featuredEvents.forEach(function(event) { %>
                <div class="featured-item" data-category="<%= getCategoryGroup(event.category) %>">
                    <div class="event-thumbnail">
                        <% if (event.media && event.media.videos && event.media.videos.length > 0) { %>
                            <div class="video-placeholder">
                                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                    <polygon points="5,3 19,12 5,21"></polygon>
                                </svg>
                            </div>
                            <div class="play-overlay">
                                <button class="play-button" data-video="<%= event._id %>" data-video-url="<%= event.media.videos[0].url || '' %>">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                        <polygon points="5,3 19,12 5,21"></polygon>
                                    </svg>
                                </button>
                            </div>
                        <% } else if (event.media && event.media.featuredImage && event.media.featuredImage.url) { %>
                            <img src="<%= event.media.featuredImage.url %>" alt="<%= event.media.featuredImage.alt || event.title %>" class="event-image" loading="lazy">
                        <% } else { %>
                            <div class="event-placeholder">
                                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21,15 16,10 5,21"></polyline>
                                </svg>
                            </div>
                        <% } %>
                    </div>
                    <div class="event-content">
                        <span class="event-category"><%= formatCategory(event.category) %></span>
                        <h3 class="event-title">
                            <a href="/events/<%= event.slug %>" class="event-title-link"><%= event.title %></a>
                        </h3>
                        <p class="event-description"><%= event.shortDescription || (event.description ? event.description.substring(0, 150) + '...' : '') %></p>
                        <div class="event-meta">
                            <div class="event-date-time">
                                <span class="event-date"><%= formatDate(event.eventDate) %></span>
                                <span class="event-time"><%= formatTime(event.startTime) %></span>
                            </div>
                            <div class="event-actions-inline">
                                <button class="add-to-calendar-btn" 
                                        data-title="<%= event.title %>" 
                                        data-date="<%= event.eventDate %>" 
                                        data-start="<%= event.startTime %>" 
                                        data-end="<%= event.endTime %>" 
                                        data-description="<%= event.shortDescription || event.description %>"
                                        data-location="<%= event.location && event.location.venue ? event.location.venue : '' %>">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    Add to Google Calendar
                                </button>
                                <button class="copy-link-btn" data-url="/events/<%= event.slug %>">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                                    </svg>
                                    Copy Link
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
</section>
<% } %>

<!-- Main Events Grid -->
<section class="events-grid-section">
    <div class="container">
        <div class="events-grid" id="eventsGrid">
            <% if (events && events.length > 0) { %>
                <% events.forEach(function(event) { %>
                    <article class="event-item" data-category="<%= getCategoryGroup(event.category) %>" data-event-id="<%= event._id %>">
                        <div class="event-thumbnail">
                            <% if (event.media && event.media.videos && event.media.videos.length > 0) { %>
                                <div class="video-placeholder">
                                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <polygon points="5,3 19,12 5,21"></polygon>
                                    </svg>
                                </div>
                                <div class="play-overlay">
                                    <button class="play-button" data-video="<%= event._id %>" data-video-url="<%= event.media.videos[0].url || '' %>">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <polygon points="5,3 19,12 5,21"></polygon>
                                        </svg>
                                    </button>
                                </div>
                            <% } else if (event.media && event.media.gallery && event.media.gallery.length > 3) { %>
                                <div class="event-collage">
                                    <img src="<%= event.media.gallery[0].url %>" alt="<%= event.media.gallery[0].alt || event.title %>" class="collage-image main" loading="lazy">
                                    <img src="<%= event.media.gallery[1].url %>" alt="<%= event.media.gallery[1].alt || event.title %>" class="collage-image small-1" loading="lazy">
                                    <img src="<%= event.media.gallery[2].url %>" alt="<%= event.media.gallery[2].alt || event.title %>" class="collage-image small-2" loading="lazy">
                                    <div class="gallery-overlay">+<%= event.media.gallery.length - 3 %> more</div>
                                </div>
                                <div class="gallery-indicator">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21,15 16,10 5,21"></polyline>
                                    </svg>
                                </div>
                            <% } else if (event.media && event.media.featuredImage && event.media.featuredImage.url) { %>
                                <img src="<%= event.media.featuredImage.url %>" alt="<%= event.media.featuredImage.alt || event.title %>" class="event-image" loading="lazy">
                                <% if (event.media && event.media.gallery && event.media.gallery.length > 0) { %>
                                    <div class="gallery-indicator">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                            <polyline points="21,15 16,10 5,21"></polyline>
                                        </svg>
                                    </div>
                                <% } %>
                            <% } else { %>
                                <div class="event-placeholder">
                                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21,15 16,10 5,21"></polyline>
                                    </svg>
                                </div>
                            <% } %>
                        </div>
                        
                        <div class="event-content">
                            <span class="event-category"><%= formatCategory(event.category) %></span>
                            <h3 class="event-title">
                                <a href="/events/<%= event.slug %>" class="event-title-link"><%= event.title %></a>
                            </h3>
                            <p class="event-description">
                                <%= event.shortDescription || (event.description && event.description.length > 120 ? event.description.substring(0, 120) + '...' : event.description || 'No description available') %>
                            </p>
                            <div class="event-meta">
                                <div class="event-date-time">
                                    <span class="event-date"><%= formatDate(event.eventDate) %></span>
                                    <span class="event-time"><%= formatTime(event.startTime) %></span>
                                </div>
                                <% if (event.location && event.location.venue) { %>
                                    <div class="event-location">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                            <circle cx="12" cy="10" r="3"></circle>
                                        </svg>
                                        <span><%= event.location.venue %></span>
                                    </div>
                                <% } %>
                            </div>
                            
                            <div class="event-actions">
                                <div class="event-actions-inline">
                                    <button class="add-to-calendar-btn" 
                                            data-title="<%= event.title %>" 
                                            data-date="<%= event.eventDate %>" 
                                            data-start="<%= event.startTime %>" 
                                            data-end="<%= event.endTime %>" 
                                            data-description="<%= event.shortDescription || event.description %>"
                                            data-location="<%= event.location && event.location.venue ? event.location.venue : '' %>">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                        Add to Google Calendar
                                    </button>
                                    <button class="copy-link-btn" data-url="/events/<%= event.slug %>">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                                        </svg>
                                        Copy Link
                                    </button>
                                </div>
                                <a href="/events/<%= event.slug %>" class="learn-more-btn">Learn More</a>
                            </div>
                        </div>
                        
                        <!-- Share Button -->
                        <button class="share-btn" data-event-id="<%= event._id %>" data-title="<%= event.title %>" data-url="/events/<%= event.slug %>">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                        </button>
                    </article>
                <% }); %>
            <% } %>
        </div>
        
        <!-- Load More Button -->
        <% if (hasMore) { %>
        <div class="load-more-container">
            <button class="load-more-btn" data-page="<%= currentPage + 1 %>" data-category="<%= currentCategory %>" data-type="future">
                <span class="load-text">Load More Events</span>
                <span class="loading-text" style="display: none;">Loading...</span>
            </button>
        </div>
        <% } %>
        
        <!-- No More Content Message -->
        <% if (!hasMore && events && events.length > 0) { %>
        <div class="no-more-content">
            <p>You've reached the end of our upcoming events.</p>
        </div>
        <% } %>
        
        <!-- No Events Message -->
        <% if (!events || events.length === 0) { %>
        <div class="no-events">
            <div class="no-events-content">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <h3>No upcoming events</h3>
                <p>Stay tuned for upcoming events and activities. Check back soon!</p>
            </div>
        </div>
        <% } %>
    </div>
</section>

<!-- Video Modal -->
<div class="video-modal" id="videoModal">
    <div class="video-modal-overlay"></div>
    <div class="video-modal-content">
        <button class="video-modal-close" aria-label="Close video">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <div class="video-container">
            <iframe id="videoFrame" src="" frameborder="0" allowfullscreen></iframe>
        </div>
    </div>
</div>

<%# EJS Helper Functions %>
<%
function formatCategory(category) {
    const categoryMap = {
        'community-service': 'Community Service',
        'educational': 'Educational',
        'religious': 'Religious',
        'cultural': 'Cultural',
        'youth': 'Youth Program',
        'interfaith': 'Interfaith',
        'fundraising': 'Fundraising',
        'health-wellness': 'Health & Wellness',
        'social': 'Social Event',
        'workshop': 'Workshop',
        'conference': 'Conference',
        'meeting': 'Meeting',
        'other': 'Other'
    };
    return categoryMap[category] || 'Event';
}

function getCategoryGroup(category) {
    if (['cultural', 'social', 'religious', 'interfaith'].includes(category)) {
        return 'events';
    } else if (['educational', 'community-service', 'fundraising'].includes(category)) {
        return 'news';
    } else {
        return 'events';
    }
}

function formatDate(date) {
    if (!date) return 'Date TBA';
    try {
        const options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        };
        return new Date(date).toLocaleDateString('en-US', options);
    } catch (error) {
        return 'Date TBA';
    }
}

function formatTime(time) {
    if (!time) return '';
    try {
        const [hours, minutes] = time.split(':');
        const timeObj = new Date();
        timeObj.setHours(parseInt(hours), parseInt(minutes));
        return timeObj.toLocaleTimeString('en-US', { 
            hour: 'numeric', 
            minute: '2-digit',
            hour12: true 
        });
    } catch (error) {
        return time;
    }
}
%>